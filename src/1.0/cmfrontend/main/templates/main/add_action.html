<?xml version="1.0" encoding="UTF-8"?>
<html lang="en">
<head>
    {% load staticfiles %}
{#    必须导入外部js#}
    <link rel="stylesheet" type="text/css" href= "{% static 'css/add_action_style.css' %}" />
    <script src="http://img.jb51.net/jslib/jquery/jquery.js" type="text/javascript"></script>
{#host和item的匹配   #}
<script>
{#从数据库取值需要加上safe不然乱码报错invalid property id#}
       var List={{ data1 | safe }} ;//把这个js提出去这里就会报错，不能从后台获取data1
       var jsonobj = JSON.parse(List);//解析JSON字符串
        $(document).ready(function(){
        $("#one").change(function() {
            var checkValue=$("#one").val();//获取one的val
            var select = document.getElementById("item");
            var select_content=""//动态拼接select的内容
            for(var i = 0; i < jsonobj.length; i++){
                if (jsonobj[i].fields.hostId == checkValue) {
                    select_content += " <option value=" + jsonobj[i].pk + ">" + jsonobj[i].fields.itemName + "</option>";
                }
            }

            select.innerHTML = select_content;//innerHTML在JS是双向功能：获取对象的内容  或  向对象插入内容，这里在插入数据
        })
        })

</script>
{#item和trigger的匹配   #}
<script>
{#从数据库取值需要加上safe不然乱码报错invalid property id#}
       var List1={{ data3 | safe }} ;//把这个js提出去这里就会报错，不能从后台获取data1
       var jsonobj1 = JSON.parse(List1);//解析JSON字符串
        $(document).ready(function(){
        $("#item").change(function() {
            var checkValue1=$("#item").val();//获取one的val
            var select1 = document.getElementById("trigger");
            var select_content1=""//动态拼接select的内容
            for(var i = 0; i < jsonobj1.length; i++){
                if (jsonobj1[i].fields.itemId == checkValue1) {
                    select_content1 += " <option value=" + jsonobj1[i].pk + ">" + jsonobj1[i].fields.triggerName + "</option>";
                }
            }

            select1.innerHTML = select_content1;//innerHTML在JS是双向功能：获取对象的内容  或  向对象插入内容，这里在插入数据
        })
        })

</script>
{#    action步骤添加#}
    <style>
        .manc,.masc{
    border: 2px dotted burlywood;
}
    </style>
<script>//动态添加操作
var collegediv =1;
var collegename=1;
function aa() {
     var o=document.getElementById("man");
     var div=document.createElement("div");
     div.id = "man"+ collegediv;
     div.className="manc"
     var deletediv=document.createElement("div");
     var deletename=o.childNodes.item(0).id+collegename;
     div.innerHTML=o.innerHTML;
     document.getElementById("div2").appendChild(div);
     div.childNodes.item(0).id=deletename;
     collegediv++;
     collegename++;

}
function bb() {
     var o=document.getElementById("mas");
     var div=document.createElement("div");
     div.id = "mas"+ collegediv;
     div.className="masc";
     var deletediv=document.createElement("div");
     var deletename=o.childNodes.item(0).id+collegename;
     div.innerHTML=o.innerHTML;
     document.getElementById("div2").appendChild(div);
     div.childNodes.item(0).id=deletename;
     collegediv++;
     collegename++;
}
function cc(obj)
{
    <!--var strid=obj.name;-->
    //获取本删除按钮的id值，并创建对象
    var strid=obj.id;
    var o=document.getElementById(strid);
    var z=o.parentElement;
    <!--var o=document.getElementsByTagName(strid)[4].parentElement;-->
    //找到这个删除按钮对应的父div的值
    <!--var stridone=document.getElementsByName(strid)[0].parentNode.id;-->
    var stridone=z.id;
    //判断本id对应的值并删除
    var my = document.getElementById(stridone);
    if (my != null){
    my.parentNode.removeChild(my);}
    <!--window.location.reload(); -->
}



</script>
<script type="text/javascript">//打开新窗体
        var child; //通过判断子窗体的引用是否为空，可以控制它只能打开一个子窗体
        function opendialog() {
            if (!child) {
                var url='http://127.0.0.1:8000/main/add_action_child/';                             //转向网页的地址;
               var name='';                            //网页名称，可为空;
               var iWidth=1000;                          //弹出窗口的宽度;
               var iHeight=600;                         //弹出窗口的高度;
               //获得窗口的垂直位置
               var iTop = (window.screen.availHeight - 30 - iHeight) / 2;
               //获得窗口的水平位置
               var iLeft = (window.screen.availWidth - 10 - iWidth) / 2;
               //弹出窗口，并居中
               window.open(url, name, 'height=' + iHeight + ',,innerHeight=' + iHeight + ',width=' + iWidth + ',innerWidth=' + iWidth + ',top=' + iTop + ',left=' + iLeft + ',status=no,toolbar=no,menubar=no,location=no,resizable=no,scrollbars=1,titlebar=no');
                //需要等待子窗口加载完成，赋值才能成功,load事件通常用于检测文档内容或者图片是否加载完毕
                {#child.onload = function() {#}
                {#    child.document.getElementById('name').value = document.getElementById('name').value;#}
                //}
            }
        }
</script>
    <meta charset="UTF-8">
    <title>action</title>
</head>
<body>
<form id="addaction" name="addaction" method="post" action="">
  {% csrf_token %}
  <p>Action name:
  <input id="actionName" name="actionName" type="text" />
  </p>
  <p>Host:
    <label>
  <select id="one" name="hostId">
            {% for host in host %}
            <option value="{{ host.hostId }}" >{{ host.hostName }}</option>
            {% endfor %}
  </select>
    </label>
  </p>
  <p>items:
    <label>
        <select id="item" name="itemId">
{#            {% for item in item %}#}
{#            <option value="{{ item.itemId }}" >{{ item.itemName }}</option>#}
{#            {% endfor %}#}
        </select>
    </label>
  </p>
  <p>Trigger:
    <label>
        <select id="trigger" name="triggerId">
{#            {% for trigger in trigger %}#}
{#            <option value="{{ trigger.triggerId }}" >{{ trigger.triggerName }}</option>#}
{#            {% endfor %}#}
        </select>
    </label>
  </p>
  <p>Default Operation Step Duration:
    <label>
        <select name="osc">
{#            {% for host in host %}#}
            <option value="120" >60s</option>
            <option value="600" >120s</option>
            <option value="1800" >1200s</option>
            <option value="3600" >3600s</option>
{#            {% endfor %}#}
        </select>
    </label>
  </p>
<div id='div1' style="display: none;">

    <div id="man" class="manc" ><input type="button" value="Delete" id="input" class="btn_list" onclick="cc(this)">
<div id="operation1">
  <p>Operation type:  Remote command
  </p>
  <p>
      step<input style="width:50px;" name="from1"/>--<input style="width:50px;" name="to1"/>(0 - infinitely)
  </p>
  <p>
      Step Duration<input style="width:50px;" name="stepduration1"/>(minimum 60 seconds, 0 - use action default)
  </p>
  <p>Opcommand host:
    <label>
        <select name="OpcommandhostId1">
            {% for host in host %}
            <option value="{{ host.hostId }}" >{{ host.hostName }}</option>
            {% endfor %}
        </select>
    </label>
  </p>
  <p>Commands:
      <input id="commands1" name="Commands1" type="text"/>
      <input type="button" id="open" value="Script" onclick="opendialog()" />
  </p>
</div>
<br />
    </div>
    </br>
</div>
<div id='div3'style="display: none;">
    <div id="mas" class="masc"><input type="button" value="Delete" id="input" class="btn_list" onclick="cc(this)">
<div id="operation2">
  <p>Operation type:  Send massage
  </p>
  <p>
      step<input style="width:50px;" name="from2"/>--<input style="width:50px;" name="to2"/>(0 - infinitely)
  </p>
  <p>
      Step duration<input style="width:50px;" name="stepduration2"/>(minimum 60 seconds, 0 - use action default)
  </p>
  <p>mediatype
      <select name="mediatype2">
          <option value="4">163-Email</option>
          <option value="2">local</option>
      </select>
  </p>
</div>
    </div>
    </br>
</div>
<p>Operation type:
<input type='button' id="btn1" value='Remote command' onclick="aa()"/>
<input type='button' id="btn2" value='Send massage' onclick="bb()"/>
</p>
<div id='div2'></div>
  <p>
    <input type="submit" name="Submit" value="ADD" />
  </p>
  <p>
      Added：{{ action_data }}
  </p>

</form>
</body>
</html>